<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; xpsi 0.7.10 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "math|output_area", "processEscapes": true, "ignoreClass": "document", "inlineMath": [["$", "$"], ["\\(", "\\)"]]}})</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Overview" href="overview.html" />
    <link rel="prev" title="X-PSI" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> xpsi
          </a>
              <div class="version">
                0.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#python-environment">Python environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-conda-environment">Basic Conda environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conda-environment-duplication">Conda environment duplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#from-source">From source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gsl-1">GSL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multinest">MultiNest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#x-psi">X-PSI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tips-for-installing-on-a-mac-os">Tips for installing on a Mac OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-on-windows">Installing on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-of-bash-profile">Example of .bash_profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-of-bashrc">Example of .bashrc</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">(FA)Q</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="SURFsara_systems.html">SURFsara systems</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">Future</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="model_construction.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_instruments.html">Instrument synergy</a></li>
<li class="toctree-l1"><a class="reference internal" href="hotregion_complexity.html">Hot region complexity</a></li>
<li class="toctree-l1"><a class="reference internal" href="global_surface_emission.html">Global surface emission</a></li>
<li class="toctree-l1"><a class="reference internal" href="surface_radiation_field_checking_tools_tutorial.html">Surface radiation field tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_construction_streamlined.html">Modeling (without statistics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_imaging.html">Multiple imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing_tutorial.html">Post-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_script.html">Example script and modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_job.html">Example job</a></li>
</ul>
<p class="caption"><span class="caption-text">Likelihood API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="parameter.html">Parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameterSubspace.html">ParameterSubspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="likelihood.html">Likelihood</a></li>
<li class="toctree-l1"><a class="reference internal" href="signal.html">Signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrument.html">Instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="star.html">Star</a></li>
<li class="toctree-l1"><a class="reference internal" href="spacetime.html">Spacetime</a></li>
<li class="toctree-l1"><a class="reference internal" href="photosphere.html">Photosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="hotregion.html">HotRegion</a></li>
<li class="toctree-l1"><a class="reference internal" href="twohotregions.html">TwoHotRegions</a></li>
<li class="toctree-l1"><a class="reference internal" href="hotregions.html">HotRegions</a></li>
<li class="toctree-l1"><a class="reference internal" href="elsewhere.html">Elsewhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="everywhere.html">Everywhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="interstellar.html">Interstellar</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background</a></li>
</ul>
<p class="caption"><span class="caption-text">Extension modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="extensions_overview.html">Overview of extension modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="surface_radiation_field.html">Surface radiation field</a></li>
<li class="toctree-l1"><a class="reference internal" href="likelihood_implementations.html">Likelihoods</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Posterior API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prior.html">Prior</a></li>
<li class="toctree-l1"><a class="reference internal" href="posterior.html">Posterior</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample.html">Sample</a></li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing.html">PostProcessing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">xpsi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/install.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="installation">
<span id="install"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="python-environment">
<span id="dev-env"></span><h2>Python environment<a class="headerlink" href="#python-environment" title="Permalink to this headline">¶</a></h2>
<p>X-PSI was developed in Python 2.7, and has not yet been ported to Python 3.
Fortunately, there are several ways to create a virtual environment with a
different version of Python, without disrupting your Python ecosystem.</p>
<p>Clone X-PSI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/xpsi-group/xpsi.git &lt;/path/to/xpsi&gt;
</pre></div>
</div>
</div>
<div class="section" id="basic-conda-environment">
<h2>Basic Conda environment<a class="headerlink" href="#basic-conda-environment" title="Permalink to this headline">¶</a></h2>
<p>In the source directory we provide a basic dependency file that installs
the core Python packages required for <em>likelihood</em> functionality. These
packages are:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.scipy.org/doc/numpy/index.html">NumPy</a></li>
<li><a class="reference external" href="http://cython.readthedocs.io/en/latest">Cython</a></li>
</ul>
<p>For likelihood evaluation, you also require the GNU Scientific Library
(<a class="reference external" href="https://www.gnu.org/software/gsl/">GSL</a>). We have included this in the
Conda environment file, but we give installation
instructions from <a class="reference internal" href="#source">source</a> below; in the latter case, you can remove the
GSL entry from the environment file prior to creation.</p>
<p>If you want to run X-PSI in a
<a class="reference external" href="https://jupyter-notebook.readthedocs.io/en/stable/">Jupyter</a>
notebook, you can add this as an entry (e.g., <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">jupyter=1.0</span></code>) to the
environment file or you can install it via Conda (or pip) after environment
creation.</p>
<p>To create a virtual environment from file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda env create -f &lt;path/to/xpsi&gt;/basic_environment.yml
</pre></div>
</div>
<p>If Conda does not solve the environment dependencies, you may need to create
an environment manually via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda create -n xpsi <span class="nv">python</span><span class="o">=</span><span class="m">2</span>.7
</pre></div>
</div>
<p>and then install the core dependencies listed in <cite>basic_environment.yml</cite>,
such as <a class="reference external" href="https://docs.scipy.org/doc/numpy/index.html">NumPy</a> and <a class="reference external" href="http://cython.readthedocs.io/en/latest">Cython</a>, and also <a class="reference external" href="https://www.gnu.org/software/gsl/">GSL</a>.</p>
</div>
<div class="section" id="conda-environment-duplication">
<h2>Conda environment duplication<a class="headerlink" href="#conda-environment-duplication" title="Permalink to this headline">¶</a></h2>
<p>In the source repository we provide a dependency file that can facilitate
exact duplication of the environment from which X-PSI <code class="docutils literal notranslate"><span class="pre">v0.6</span></code> was
released. This information may be useful if trying to diagnose installation
problems, but can only be expected to be compatible with the same platform.</p>
<p>The development environment:</p>
<blockquote>
<div><ul class="simple">
<li>Ubuntu 14.04</li>
<li>Installed globally via <code class="docutils literal notranslate"><span class="pre">apt</span></code>: GCC 4.8.4; Open MPI 1.6.5 (“ancient”);
BLAS; LAPACK; ATLAS.</li>
<li><a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html">Miniconda2</a>
(Python 2.7; 64-bit)</li>
<li>Conda environment exported to <code class="docutils literal notranslate"><span class="pre">xpsi/environment.yml</span></code></li>
</ul>
</div></blockquote>
<p>When inspecting the <code class="docutils literal notranslate"><span class="pre">xpsi/environment.yml</span></code> file, note that most of the
entries were installed via automatic resolution of a strict dependency chain
when core packages were specified. Also note the packages that
were installed into a Conda environment via pip. There are a few reasons
for these choices, but the main one is that pip is purely for Python
packages and will not install unwanted non-Python libraries. To be clear, such
libraries would be dependencies that could have been installed via Conda,
if we had not already satisfied them as listed above in this instance.</p>
<p>The Python packages below can be installed straightforwardly from source
or via a package manager (Conda, pip, or a combination), via the instructions
native to the packages. When searching for an open-source package you may need
to add <em>conda-forge</em> package channel.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The specifications on this page regard the development environment:
you are free to set up alternative environment. For installation on a
high-performance system, instructions on this page, which tailor to a
self-administered machine, are either not applicable or do not target
performance. We direct the reader to the <a class="reference internal" href="SURFsara_systems.html#surfsystems"><span class="std std-ref">SURFsara systems</span></a> page for
guidance.</p>
</div>
<p>To duplicate from file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda env create -f &lt;path/to/xpsi&gt;/environment.yml
</pre></div>
</div>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>The following Python packages are required for nested sampling:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/JohannesBuchner/PyMultiNest">PyMultiNest</a>
(the interface to the MultiNest library)</li>
<li><a class="reference external" href="https://bitbucket.org/mpi4py/mpi4py/downloads/">mpi4py</a>
(for parallelisation)</li>
<li><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/">SciPy</a>
(optional core package useful for, e.g., inverse prior sampling)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">That <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">pymultinest</span></code> might try to install
dependencies in the environment, including binaries for MPI, BLAS/LAPACK,
and a Fortran compiler, all in order to install MultiNest. Moreover, the
MultiNest version listed is a minor release too low to satisfy all our
needs. Although production sampling runs need to be performed on a
high-performance system, it is advisable to install MultiNest on your
personal machine to gain experience on application to inexpensive test
problems. Below we offer <a class="reference internal" href="#source">from source</a> instructions.</p>
</div>
<p>The following Python packages are required for full functionality of the
post-processing module:</p>
<ul class="simple">
<li><a class="reference external" href="https://matplotlib.org/">Matplotlib</a></li>
<li><a class="reference external" href="https://getdist.readthedocs.io/en/latest/">GetDist</a>
(posterior KDE corner plotting)<a class="footnote-reference" href="#footnote-1" id="footnote-reference-1">[1]</a></li>
<li><a class="reference external" href="http://docs.h5py.org/en/stable/">h5py</a>
(storage of X-ray signals computed from posterior samples; also used by
<a class="reference external" href="https://emcee.readthedocs.io/en/latest/">emcee</a>)</li>
<li><a class="reference external" href="https://nestcheck.readthedocs.io/en/latest/">nestcheck</a>
(posterior error analysis, plotting, run combination, etc.)<a class="footnote-reference" href="#footnote-2" id="footnote-reference-2">[2]</a></li>
<li><a class="reference external" href="https://fgivenx.readthedocs.io/en/latest/">fgivenx</a>
(conditional posterior plotting; also required by nestcheck)</li>
</ul>
<p>Note that post-processing can generally be done on a desktop computer and thus
these packages are not necessary for running sampling processes on a
high-performance system. If they are not installed, a warning message is
printed or an exception is raised (by the root process if MPI world size &gt;1).</p>
<p>The <a class="reference external" href="https://emcee.readthedocs.io/en/latest/">emcee</a> Python package for
ensemble-MCMC is optional.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">That <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">emcee</span></code> will handle dependencies
recursively to the extent that MPI would be installed if you accept.</p>
</div>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="footnote-1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-1">[1]</a></td><td><p class="first">The version of <a class="reference external" href="https://getdist.readthedocs.io/en/latest/">GetDist</a> currently compatible with X-PSI, and used in
<a class="reference internal" href="applications.html#r19"><span class="std std-ref">Riley et al. 2019 (ApJL, 887, L21)</span></a>, is v0.3.1. It may be cloned as follows:</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone <span class="o">[</span>--single-branch<span class="o">]</span> -b customisation <span class="se">\</span>
https://github.com/ThomasEdwardRiley/getdist.git
</pre></div>
</div>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="footnote-2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-2">[2]</a></td><td><p class="first">The version of <a class="reference external" href="https://nestcheck.readthedocs.io/en/latest/">nestcheck</a> currently compatible with X-PSI, and used in
<a class="reference internal" href="applications.html#r19"><span class="std std-ref">Riley et al. 2019 (ApJL, 887, L21)</span></a>, is v0.2.0. It may be cloned as follows:</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone <span class="o">[</span>--single-branch<span class="o">]</span> -b feature/getdist_kde <span class="se">\</span>
https://github.com/ThomasEdwardRiley/nestcheck.git
</pre></div>
</div>
</td></tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For installing X-PSI on a Mac OS, please look at the tips below before proceeding with the installation of the various depnedencies.</p>
</div>
</div>
<div class="section" id="from-source">
<span id="source"></span><h2>From source<a class="headerlink" href="#from-source" title="Permalink to this headline">¶</a></h2>
<p>X-PSI has several dependencies that are not Python packages. Build and
install guidelines are given below.</p>
<div class="section" id="gsl-1">
<h3>GSL<a class="headerlink" href="#gsl-1" title="Permalink to this headline">¶</a></h3>
<p>To obtain the latest <a class="reference external" href="https://www.gnu.org/software/gsl/">GSL</a> source code (otherwise <code class="docutils literal notranslate"><span class="pre">v2.5</span></code> works):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget -v http://mirror.koddos.net/gnu/gsl/gsl-latest.tar.gz
</pre></div>
</div>
<p>Untar, navigate to the build directory (e.g., <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">gsl-latest/build</span></code>), and
then build and install:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>../configure <span class="nv">CC</span><span class="o">=</span>&lt;path/to/compiler/executable&gt; --prefix<span class="o">=</span><span class="nv">$HOME</span>/gsl
make
make check
make install
make installcheck
make clean
</pre></div>
</div>
<p>This will install the library in your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>, as an example. You can check
the prefix and version of GSL on your path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gsl-config --version
gsl-config --prefix
</pre></div>
</div>
</div>
<div class="section" id="multinest">
<h3>MultiNest<a class="headerlink" href="#multinest" title="Permalink to this headline">¶</a></h3>
<p>To leverage some capabilities of sample post-processing software you require
<a class="reference external" href="https://github.com/farhanferoz/MultiNest">MultiNest</a> <code class="docutils literal notranslate"><span class="pre">v3.11</span></code>. To build the MultiNest library,
you require an MPI-wrapped Fortran compiler (e.g., <code class="docutils literal notranslate"><span class="pre">mpifort</span></code> from Open MPI).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following assumes an environment similar to that summarised in
the in the <a class="reference internal" href="#dev-env"><span class="std std-ref">Python environment</span></a> section above, specifically to emphasise where an
MPI compiler wrapper is required.</p>
</div>
<p>First clone the repository, then navigate to it and build:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/farhanferoz/MultiNest.git &lt;path/to/clone&gt;/multinest
<span class="nb">cd</span> &lt;path/to/clone&gt;/multinest/MultiNest_v3.11_CMake/multinest
mkdir build
<span class="nb">cd</span> build
<span class="nv">CC</span><span class="o">=</span>gcc <span class="nv">FC</span><span class="o">=</span>mpif90 <span class="nv">CXX</span><span class="o">=</span>g++ cmake -DCMAKE_<span class="o">{</span>C,CXX<span class="o">}</span><span class="nv">_FLAGS</span><span class="o">=</span><span class="s2">&quot;-O3 -march=native -funroll-loops&quot;</span> -DCMAKE_Fortran_FLAGS<span class="o">=</span><span class="s2">&quot;-O3 -march=native -funroll-loops&quot;</span> ..
make
ls ../lib/
</pre></div>
</div>
<p>Use the last command to check for the presence of shared objects. There is
<em>no</em> need to <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> as suggested in the source code documentation.</p>
<p>If you have not already installed mpi4py using pip (or Conda assuming a
different environment setup to that summarised in <a class="reference internal" href="#dev-env"><span class="std std-ref">Python environment</span></a>), then here
is how to do it from source (e.g., on some path such as <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget https://bitbucket.org/mpi4py/mpi4py/downloads/mpi4py-3.0.0.tar.gz

tar -xf mpi4py-3.0.0.tar.gz

python setup.py build --mpicc<span class="o">=</span>mpicc

python setup.py install
</pre></div>
</div>
<p>The package will be installed in your Conda environment (if activated).</p>
<p>To test:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpiexec -n <span class="m">4</span> python demo/helloworld.py
</pre></div>
</div>
<p>Do you see ranks 0 through 3 reporting for duty? The number of MPI processes
might be best set to somewhere between the number of physical cores and
logical cores in your machine for test sampling applications. For a typical
laptop that might be up to <code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">4</span></code>.</p>
<p>Now you need the Python interface to MultiNest:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/JohannesBuchner/PyMultiNest.git &lt;path/to/clone&gt;/pymultinest
<span class="nb">cd</span> &lt;path/to/clone&gt;/pymultinest
python setup.py install <span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>The package will be installed in your Conda environment (if activated).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Here we clone the PyMultiNest repository. However, for <a class="reference internal" href="applications.html#r19"><span class="std std-ref">Riley et al. 2019 (ApJL, 887, L21)</span></a>,
working with X-PSI <code class="docutils literal notranslate"><span class="pre">v0.1</span></code>, we used the repository as frozen in a <em>fork</em>.
To clone this version instead:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/ThomasEdwardRiley/PyMultiNest.git &lt;path/to/clone&gt;
</pre></div>
</div>
<p class="last">and then simply follow the same installation procedure.</p>
</div>
</div>
<div class="section" id="x-psi">
<h3>X-PSI<a class="headerlink" href="#x-psi" title="Permalink to this headline">¶</a></h3>
<p>To build and install from the X-PSI clone root, you require an
<a class="reference external" href="http://www.openmp.org">OpenMP</a>-enabled C compiler (known compatibility with <code class="docutils literal notranslate"><span class="pre">icc</span></code>, <code class="docutils literal notranslate"><span class="pre">gcc</span></code>, and
<code class="docutils literal notranslate"><span class="pre">clang</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>&lt;path/to/compiler/executable&gt; python setup.py install <span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--user</span></code> flag is optional and specifies where the package is installed;
if you want to install the package in a virtual environment, omit this flag.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">icc</span></code>, you may need to prepend this command with
<code class="docutils literal notranslate"><span class="pre">LDSHARED=&quot;icc</span> <span class="pre">-shared&quot;</span></code>. This ensures that both the compiler and linker
are Intel, otherwise the <code class="docutils literal notranslate"><span class="pre">gcc</span></code> linker might be invoked.</p>
<p>Provided the GSL <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;/bin</span></code> is in your <code class="docutils literal notranslate"><span class="pre">PATH</span></code>
environment variable, the X-PSI <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script will automatically use the
<code class="docutils literal notranslate"><span class="pre">gsl-config</span></code> executable to link the shared libraries and give the required
C flags for compilation of the X-PSI extensions. Because the library location
will not change for runtime, we state the runtime linking instructions at
compilation in the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To install X-PSI on Mac OS, you can use <code class="docutils literal notranslate"><span class="pre">llvm</span> <span class="pre">clang</span></code> rather than <code class="docutils literal notranslate"><span class="pre">gcc</span></code>.
First install <code class="docutils literal notranslate"><span class="pre">homebrew</span></code> and use that to install <code class="docutils literal notranslate"><span class="pre">llvm</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/usr/bin/ruby -e
<span class="s2">&quot;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">&quot;</span>

brew install llvm
</pre></div>
</div>
<p>Modify your <code class="docutils literal notranslate"><span class="pre">.profile</span></code> file as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/usr/local/opt/llvm/bin:<span class="nv">$PATH</span>
<span class="nb">export</span> <span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-L/usr/local/opt/llvm/lib&quot;</span>
<span class="nb">export</span> <span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">&quot;-I/usr/local/opt/llvm/include&quot;</span>
<span class="nb">export</span> <span class="nv">KMP_DUPLICATE_LIB_OK</span><span class="o">=</span>TRUE
</pre></div>
</div>
<p>Install X-PSI using</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>/usr/local/opt/llvm/bin/clang python setup.py install <span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
</div>
<p>If you ever need to reinstall, first clean to recompile the C files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm -r build dist *egg* xpsi/*/*.c
</pre></div>
</div>
<p>Alternatively, to build X-PSI in-place:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>&lt;path/to/compiler/executable&gt; python setup.py build_ext -i
</pre></div>
</div>
<p>This will build extension modules in the source code directory. You must in
this case ensure that the source code directory is on your <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>
environment variable, or inserted into <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> within a calling module.</p>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>If you wish to compile the documentation you require <a class="reference external" href="http://www.sphinx-doc.org/en/master">Sphinx</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> xpsi/docs<span class="p">;</span> <span class="o">[</span>make clean<span class="p">;</span><span class="o">]</span> make html
</pre></div>
</div>
<p>To rebuild the documentation after a change to source code docstrings:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span><span class="nv">CC</span><span class="o">=</span>&lt;compiler&gt;<span class="o">]</span> python setup.py install <span class="o">[</span>--user<span class="o">]</span><span class="p">;</span> <span class="nb">cd</span> docs<span class="p">;</span> make clean<span class="p">;</span> make html<span class="p">;</span> <span class="nb">cd</span> ..
</pre></div>
</div>
<p>You need the relevant extensions (such as <code class="docutils literal notranslate"><span class="pre">nbsphinx</span></code>, which you will be
prompted to install) and atheme such as the Sphinx <a class="reference external" href="https://sphinx-rtd-theme.readthedocs.io/en/latest/">Read the Docs theme</a>.
Customisation can be made in the <code class="docutils literal notranslate"><span class="pre">xpsi/docs/source/conf.py</span></code> script.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.html</span></code> files can then found in <code class="docutils literal notranslate"><span class="pre">xpsi/docs/build/html</span></code>, along with the
notebooks for the tutorials in this documentation. The <code class="docutils literal notranslate"><span class="pre">.html</span></code> files can
naturally be opened in a browser, handily via a Jupyter session (this is
particularly useful if the edits are to tutorial notebooks).</p>
<p>Note that if you require links to the source code in the HTML files, you need
to ensure Sphinx imports the <code class="docutils literal notranslate"><span class="pre">xpsi</span></code> package from the source directory
instead of from the <code class="docutils literal notranslate"><span class="pre">~/.local/lib</span></code> directory of the user. To enforce this,
insert the path to the source directory into <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> in the <code class="docutils literal notranslate"><span class="pre">conf.py</span></code>
script. Then make sure the extension modules are inside the source directory
– i.e., the package is built in-place (see above).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To build the documentation, all modules need to be imported, and the
dependencies that are not resolved will print warning messages.</p>
</div>
</div>
<div class="section" id="tips-for-installing-on-a-mac-os">
<h2>Tips for installing on a Mac OS<a class="headerlink" href="#tips-for-installing-on-a-mac-os" title="Permalink to this headline">¶</a></h2>
<p>Be mindful on the order of the programs that need to be installed.
Install <code class="docutils literal notranslate"><span class="pre">xcode</span></code> or <code class="docutils literal notranslate"><span class="pre">xcode</span> <span class="pre">tools</span></code>.
Install <code class="docutils literal notranslate"><span class="pre">GSL</span></code> (see above).
Install <code class="docutils literal notranslate"><span class="pre">maplotlib</span></code>, <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">cython</span></code>, <code class="docutils literal notranslate"><span class="pre">h5py</span></code> and <code class="docutils literal notranslate"><span class="pre">emcee</span></code> using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>.
Install  <code class="docutils literal notranslate"><span class="pre">homebrew</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/usr/bin/ruby -e <span class="s2">&quot;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Install <code class="docutils literal notranslate"><span class="pre">llvm</span></code> with homebrew, even if weird messages appear, saying llvm is already present in the Mac OS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew install llvm
</pre></div>
</div>
<p>Install <code class="docutils literal notranslate"><span class="pre">fortran</span></code> before <code class="docutils literal notranslate"><span class="pre">MPI</span></code>.
If you have some troubles with specifying or using gfortran (and it “doesn’t not pass simple tests”) specify in the mpif90 wrapper files the compiler as being gfortran and delete the files that were already in the build directory.
Once <code class="docutils literal notranslate"><span class="pre">MPI</span></code> is installed,
export PATH and LD_LIBRARY_PATH:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;/Users/&lt;your_path&gt;/openmpi/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
<span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/Users/&lt;your_path&gt;/mpi/bin/
</pre></div>
</div>
<p>Consider if to add these lines directly in your bashrc (or equivalent file for a different shell).</p>
<p>Install <code class="docutils literal notranslate"><span class="pre">X-PSI</span></code> using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>/usr/local/opt/llvm/bin/clang python setup.py install <span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>If it gives problem, remove the <code class="docutils literal notranslate"><span class="pre">tools</span></code> and <code class="docutils literal notranslate"><span class="pre">surface_radiation_field</span></code> entires from <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> of <code class="docutils literal notranslate"><span class="pre">X-PSI</span></code>.
The line in the setup.py file would then look like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">packages</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;xpsi&#39;</span>, <span class="s1">&#39;xpsi/PostProcessing&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>If you encounter any problems with permissions when installing X-PSI, use the <code class="docutils literal notranslate"><span class="pre">--user</span></code> option.</p>
<p>For compatibility, install the <code class="docutils literal notranslate"><span class="pre">GetDist</span></code> and <code class="docutils literal notranslate"><span class="pre">nestcheck</span></code> versions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>GetDist version: <span class="m">0</span>.3.1
nestcheck version: <span class="m">0</span>.2.0
</pre></div>
</div>
</div>
<div class="section" id="installing-on-windows">
<h2>Installing on Windows<a class="headerlink" href="#installing-on-windows" title="Permalink to this headline">¶</a></h2>
<p>X-PSI has been successfully installed and run on Windows, at least for the
purpose of likelihood functionality, using the following user-contributed
procedure.</p>
<ul class="simple">
<li>Clone the X-PSI repository to a directory on your Windows computer (see above).</li>
<li>Download <a class="reference external" href="https://www.windowscentral.com/install-windows-subsystem-linux-windows-10">Ubuntu</a> for Windows.</li>
<li>Install <a class="reference external" href="https://help.dreamhost.com/hc/en-us/articles/115000218612-Installing-a-custom-version-of-Python">Python 2.7</a>.</li>
<li>Create a <a class="reference external" href="https://help.dreamhost.com/hc/en-us/articles/215489338-Installing-and-using-virtualenv-with-Python-2">virtual Python environment</a> in an Ubuntu shell.</li>
<li>Install supporting packages <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">matplotlib</span> <span class="pre">numpy</span> <span class="pre">cython</span> <span class="pre">scipy</span></code>
followed by <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">libgsl-dev</span></code>.</li>
<li>Ensure you are in the X-PSI directory and install X-PSI
<code class="docutils literal notranslate"><span class="pre">CC=gcc</span> <span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code>.</li>
<li>Install any missing packages that you need, e.g., <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">h5py</span></code> for
post-processing functionality if you have posterior sample sets available.</li>
<li>Install Jupyter notebook using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">notebook</span></code>.</li>
<li>Start the kernel with the command <code class="docutils literal notranslate"><span class="pre">Jupyter</span> <span class="pre">notebook</span></code>.</li>
</ul>
</div>
<div class="section" id="example-of-bash-profile">
<h2>Example of .bash_profile<a class="headerlink" href="#example-of-bash-profile" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># .bash_profile</span>
<span class="c1"># Get the aliases and functions</span>
<span class="k">if</span> <span class="o">[</span> -f ~/.bashrc <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    . ~/.bashrc
<span class="k">fi</span>
<span class="c1"># User specific environment and startup programs</span>
<span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HOME</span>/bin
<span class="nb">export</span> PATH
</pre></div>
</div>
</div>
<div class="section" id="example-of-bashrc">
<h2>Example of .bashrc<a class="headerlink" href="#example-of-bashrc" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module load pre2019
module load intel/2017b
module load cmake
module load python/2.7.9
<span class="nb">export</span> <span class="nv">FC</span><span class="o">=</span>ifort
<span class="nb">export</span> <span class="nv">CC</span><span class="o">=</span>icc
<span class="nb">export</span> <span class="nv">CXX</span><span class="o">=</span>icpc
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$HOME</span>/multinest/MultiNest_v3.12_CMake/multinest/lib/
<span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$HOME</span>/.local/lib/python2.7/site-packages/:<span class="nv">$PYTHONPATH</span>
<span class="c1"># Source global definitions</span>
<span class="k">if</span> <span class="o">[</span> -f /etc/bashrc <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    . /etc/bashrc
<span class="k">fi</span>
<span class="c1"># User specific aliases and functions</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="X-PSI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="overview.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, 2020, 2021 Thomas E. Riley.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>